{% extends 'base.html' %}
{% block add_css %}
<link href="https://global.oktacdn.com/okta-signin-widget/3.1.6/css/okta-sign-in.min.css" type="text/css" rel="stylesheet" />
{% if custom_css %}<link href="/static/css/{{ custom_css }}.css" rel="stylesheet" />{% endif %}
{% endblock %}

{% block content %}
<div id="okta-login-container"></div>
{% endblock %}
{% block add_js %}
<script src="https://global.oktacdn.com/okta-signin-widget/3.1.6/js/okta-sign-in.min.js" type="text/javascript"></script>
<script src="/static/js/util.js"></script>
<script type="text/javascript">
const oktaSignIn = new OktaSignIn({{ widget_conf|safe }});

function cb(result) {
  window.location.href = "/";
}

oktaSignIn.renderEl(
  { el: '#okta-login-container' },
  function success(res) {
    var data = JSON.stringify(res);
    // TODO change "OKTA_AUDIENCE" to APP_URL or something
    var result = ajax('{{ config.OKTA_AUDIENCE }}/implicit/callback', 'POST', data, cb);
  },
  function error(err) {
    // handle errors as needed
    console.error(err);
  }
);
</script>
{% endblock %}
